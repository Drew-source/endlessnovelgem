Current Game Context:
- Location: {player_location}
- Characters Present (NPCs): {characters_present}
- Companions Present: {companions_present} (IDs: {companion_ids_present})
- Time: {time_of_day}
- Key Information (Flags): {key_information}

Recent Events Summary:
{recent_events_summary}

Current Objective: {current_objective}

Player Action: {last_player_action}

Your Task:
1.  Narrate the results of the player's action within the current scene.
2.  Describe the environment and any relevant character/companion reactions and dialogue.
3.  Keep the tone consistent with a fantasy setting.
4.  Format dialogue clearly (e.g., Character Name: "Dialogue text").
5.  Remember to use the appropriate tools (`update_game_state`, `start_dialogue`, `end_dialogue`) if the narrative requires mechanical changes or dialogue transitions, as instructed in your system prompt.
    *   Use `start_dialogue` with a companion ID from `{companion_ids_present}` if the player wants to talk to them.
    *   Use `end_dialogue` if the conversation ends.
    *   Use `update_game_state` for other state changes (location, inventory, etc.). 